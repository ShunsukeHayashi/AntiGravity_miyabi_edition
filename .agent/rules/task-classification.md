---
trigger: always_on
description: Task classification and execution strategy for AntiGravity IDE
---

# Task Classification - タスク分類

AntiGravity IDE におけるタスク分類と実行戦略を定義します。

## 🎯 タスク分類の目的

タスクの規模と影響度に応じて適切なアプローチを選択し、効率的かつ安全な開発を実現します。

## 📊 3段階分類

### 🟢 軽量タスク (Light Task)

**定義**:
- 単一ファイルの小さな修正
- バグ原因の特定
- ログ追加
- コメント修正
- 変数名のリネーム

**アプローチ**:
- 最短経路で解を出す
- 深い設計議論は避ける
- 即座に実装可能

**実行フロー**:
```
ユーザー指示 → 簡単な確認 → 即座に実装 → 完了報告
```

**例**:
```markdown
ユーザー: "agent-manager.ts のログを追加して"

AI:
1. ファイルを確認
2. ログを追加
3. 完了報告

✅ 完了: agent-manager.ts にログを追加しました
```

---

### 🟡 標準タスク (Standard Task)

**定義**:
- 複数ファイルにまたがる変更
- 新機能の追加
- リファクタリング
- テスト追加
- ドキュメント作成

**アプローチ**:
- 簡潔な分析とチェックリストを先に提示
- ユーザーの確認後に実装
- 段階的な進行

**実行フロー**:
```
ユーザー指示 → 分析 → チェックリスト提示 → 確認 → 実装 → テスト → 完了報告
```

**チェックリスト例**:
```markdown
## 実装チェックリスト

### 変更ファイル
- [ ] src/agent/manager.ts - 機能追加
- [ ] src/agent/manager.test.ts - テスト追加
- [ ] src/agent/types.ts - 型定義追加

### 手順
1. 型定義作成
2. 実装
3. テスト作成
4. 動作確認

これで進めてよろしいですか？
```

---

### 🔴 重要タスク (Critical Task)

**定義**:
- 認証・セキュリティ関連
- データベーススキーマ変更
- インフラ・デプロイ設定
- 本番環境に影響する変更
- 外部API統合
- コスト影響がある変更

**アプローチ**:
- 実装前に詳細な計画書を提示
- ユーザーの明示的な承認を必須
- リスク評価を含める
- ロールバック計画を準備

**実行フロー**:
```
ユーザー指示 → 要件分析 → 詳細計画書作成 → ユーザー承認待ち → 実装 → レビュー → テスト → 承認 → デプロイ
```

**計画書例**:
```markdown
## 実装計画書: ユーザー認証機能

### 概要
JWT認証を実装し、セキュアなユーザー管理を実現

### 影響範囲
- 🔴 セキュリティ関連（認証・認可）
- 🔴 データベーススキーマ変更（users テーブル追加）
- 🟡 API エンドポイント変更

### 実装詳細
1. JWT認証ミドルウェア作成
2. ユーザーテーブル作成（マイグレーション）
3. ログイン/ログアウトAPI実装
4. 認証保護されたエンドポイント実装

### セキュリティ考慮事項
- パスワードのハッシュ化（bcrypt）
- JWTトークンの有効期限設定
- HTTPS必須
- XSS/CSRF対策

### テスト計画
- 単体テスト（カバレッジ 80%以上）
- 統合テスト
- セキュリティテスト

### ロールバック計画
- マイグレーションのロールバックスクリプト準備
- フィーチャーフラグで機能を無効化可能

### リスク
🔴 高リスク: データベーススキーマ変更（ロールバック複雑）
🟡 中リスク: 既存APIへの影響

**この計画で承認いただけますか？**
```

---

## 🚀 並列処理戦略

### 並列実行可能

以下の操作は依存関係がなければ並列実行します：

**読み取り系**:
- ✅ ファイル閲覧（複数ファイル同時）
- ✅ コード検索（Grep）
- ✅ ファイル検索（Glob）
- ✅ パッケージ情報取得

**例**:
```typescript
// 並列実行
Promise.all([
  readFile('src/agent/manager.ts'),
  readFile('src/agent/coordinator.ts'),
  grep('AgentManager', 'src/'),
]);
```

### 並列実行不可

以下の操作は逐次実行します：

**書き込み系**:
- ❌ ファイル編集（競合防止）
- ❌ コマンド実行（状態変更）
- ❌ テスト実行（副作用あり）

**例**:
```typescript
// 逐次実行
await editFile('src/agent/manager.ts', changes1);
await editFile('src/agent/coordinator.ts', changes2);
await runTests();
```

---

## ✅ 品質基準

### すべてのタスクで必須

- ✅ TypeScript strict mode 合格
- ✅ ESLint エラーゼロ
- ✅ Prettier フォーマット済み

### 禁止事項

- ❌ `any` 型でエラーを隠す
- ❌ Lint エラーの放置
- ❌ テストなしでの実装（標準・重要タスク）
- ❌ セキュリティチェックの省略（重要タスク）

### タスク別追加要件

| タスク | 追加要件 |
|--------|---------|
| 🟢 軽量 | なし |
| 🟡 標準 | テストカバレッジ 80%以上 |
| 🔴 重要 | セキュリティレビュー、ロールバック計画 |

---

## 🎓 タスク分類の判断基準

### 判断フローチャート

```
本番環境に影響? → YES → 🔴 重要タスク
  ↓ NO
セキュリティ関連? → YES → 🔴 重要タスク
  ↓ NO
コスト影響? → YES → 🔴 重要タスク
  ↓ NO
複数ファイル変更? → YES → 🟡 標準タスク
  ↓ NO
                     → 🟢 軽量タスク
```

### 具体例

| タスク | 分類 | 理由 |
|--------|------|------|
| ログ追加 | 🟢 軽量 | 単一ファイル、影響小 |
| バグ修正（複数ファイル） | 🟡 標準 | 複数ファイル、テスト必要 |
| 新機能実装 | 🟡 標準 | 複数ファイル、テスト必要 |
| 認証機能追加 | 🔴 重要 | セキュリティ、DB変更 |
| AWS設定変更 | 🔴 重要 | インフラ、コスト影響 |
| リファクタリング（小規模） | 🟢 軽量 | 単一ファイル |
| リファクタリング（大規模） | 🟡 標準 | 複数ファイル |
| スキーマ変更 | 🔴 重要 | データベース |

---

## 📋 実行テンプレート

### 🟢 軽量タスクテンプレート

```markdown
## タスク: {タスク名}

分類: 🟢 軽量タスク

### 実行内容
1. {ステップ1}
2. {ステップ2}

### 変更ファイル
- {ファイル名}

✅ 実行します
```

### 🟡 標準タスクテンプレート

```markdown
## タスク: {タスク名}

分類: 🟡 標準タスク

### チェックリスト
- [ ] {項目1}
- [ ] {項目2}
- [ ] {項目3}

### 変更ファイル
- {ファイル1}
- {ファイル2}

### テスト計画
- {テスト内容}

これで進めてよろしいですか？
```

### 🔴 重要タスクテンプレート

```markdown
## 実装計画書: {タスク名}

分類: 🔴 重要タスク

### 概要
{詳細な説明}

### 影響範囲
- 🔴 {重要な影響}
- 🟡 {中程度の影響}

### 実装詳細
1. {ステップ1}
2. {ステップ2}

### セキュリティ考慮事項
- {セキュリティポイント}

### テスト計画
- {テスト内容}

### ロールバック計画
- {ロールバック手順}

### リスク
🔴 高リスク: {リスク内容}
🟡 中リスク: {リスク内容}

**承認をお願いします**
```

---

## 🔄 タスク完了報告

### 軽量タスク

```markdown
✅ 完了: {タスク名}

変更:
- {変更内容}
```

### 標準タスク

```markdown
✅ 完了: {タスク名}

実施内容:
- {実施内容1}
- {実施内容2}

テスト結果:
- ✅ 全テスト成功
- ✅ カバレッジ 85%

品質チェック:
- ✅ TypeScript エラーゼロ
- ✅ ESLint エラーゼロ
```

### 重要タスク

```markdown
✅ 完了: {タスク名}

実施内容:
- {実施内容1}
- {実施内容2}

テスト結果:
- ✅ 単体テスト成功
- ✅ 統合テスト成功
- ✅ セキュリティテスト成功

品質チェック:
- ✅ ReviewAgent 評価: 85点
- ✅ セキュリティスキャン: 問題なし

次のステップ:
- {デプロイ手順など}
```

---

## 🎯 エスカレーション

以下の場合は TechLead / CISO / CTO にエスカレーション:

| 状況 | エスカレーション先 |
|------|-------------------|
| アーキテクチャ判断が必要 | TechLead |
| セキュリティ懸念 | CISO |
| 本番環境への大規模変更 | CTO |
| コスト影響が大きい | CTO |
| データ損失のリスク | CTO + TechLead |

---

## 🔗 関連ルール

- [planning-mode-guard.md](./planning-mode-guard.md) - Planning Mode 動作制御
- [code-style-guide.md](./code-style-guide.md) - コーディング規約
- [code-generation-guide.md](./code-generation-guide.md) - コード生成ガイドライン

---

🌸 **Miyabi Framework** - Beauty in Autonomous Development

タスクを適切に分類することで、効率的で安全な開発が実現します。
